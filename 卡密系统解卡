-- =============================================
-- ç½—å¸ƒä¹æ€å¡å¯†éªŒè¯ç³»ç»Ÿ - å¸¦è‡ªåŠ¨å‘è¨€
-- ä½œè€…: AIåŠ©æ‰‹
-- ç‰ˆæœ¬: v1.0
-- =============================================

local CardAuthSystem = {}
CardAuthSystem.__index = CardAuthSystem

function CardAuthSystem:new()
    local system = setmetatable({}, CardAuthSystem)
    system:initialize()
    return system
end

function CardAuthSystem:initialize()
    self.isVerified = false
    self.attempts = 0
    self.maxAttempts = 3
    self.lockTime = 0
    
    -- å¡å¯†æ•°æ®åº“
    self.cardDatabase = {
        ["NINJA-2024-VIP"] = { type = "VIP", days = 30, used = false },
        ["ROBLOX-PRO-ACCESS"] = { type = "PRO", days = 7, used = false },
        ["MASTER-CODE-999"] = { type = "MASTER", days = 90, used = false },
        ["LM-nbnbklr/www.ï¼Ÿ"] = { type = "æé¸¡å¡å¯†", days = 1, used = false }
    }
    
    -- æ‚¨çš„å®˜æ–¹é“¾æ¥
    self.officialLink = "https://link-target.net/1406753/FDJ7SKf8rNUB"
    
    -- è‡ªåŠ¨å‘è¨€å†…å®¹
    self.autoMessages = {       
        "åˆ˜æŸè„šæœ¬ç‰›ğŸ‘ƒğŸ˜¡ğŸ˜¡",
    }
end

-- åˆ›å»ºç´§å‡‘éªŒè¯ç•Œé¢
function CardAuthSystem:createCompactUI()
    -- ä¸»GUI
    self.screenGui = Instance.new("ScreenGui")
    self.screenGui.Name = "CardAuthSystem"
    self.screenGui.Parent = game:GetService("CoreGui")
    
    -- èƒŒæ™¯é®ç½©
    self.background = Instance.new("Frame")
    self.background.Size = UDim2.new(1, 0, 1, 0)
    self.background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    self.background.BackgroundTransparency = 0.2
    self.background.BorderSizePixel = 0
    self.background.Parent = self.screenGui
    
    -- ä¸»æ¡†æ¶ - æ›´å°å°ºå¯¸
    self.mainFrame = Instance.new("Frame")
    self.mainFrame.Size = UDim2.new(0, 350, 0, 320)
    self.mainFrame.Position = UDim2.new(0.5, -175, 0.5, -160)
    self.mainFrame.BackgroundColor3 = Color3.fromRGB(25, 30, 45)
    self.mainFrame.BorderSizePixel = 0
    self.mainFrame.Parent = self.screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = self.mainFrame
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(0, 150, 255)
    stroke.Thickness = 2
    stroke.Parent = self.mainFrame
    
    -- æ ‡é¢˜æ 
    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1, 0, 0, 40)
    titleBar.BackgroundColor3 = Color3.fromRGB(35, 40, 60)
    titleBar.BorderSizePixel = 0
    titleBar.Parent = self.mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 12)
    titleCorner.Parent = titleBar
    
    -- æ ‡é¢˜æ–‡å­—
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, 0, 1, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "åˆ˜æŸæˆæƒéªŒè¯"
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextSize = 18
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.Parent = titleBar
    
    -- è¯´æ˜æ–‡å­—
    local descLabel = Instance.new("TextLabel")
    descLabel.Size = UDim2.new(1, -20, 0, 40)
    descLabel.Position = UDim2.new(0, 10, 0, 50)
    descLabel.BackgroundTransparency = 1
    descLabel.Text = "è¾“å…¥å¡å¯†æ¿€æ´»åˆ˜æŸè„šæœ¬"
    descLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
    descLabel.TextSize = 12
    descLabel.TextWrapped = true
    descLabel.Font = Enum.Font.Gotham
    descLabel.Parent = self.mainFrame
    
    -- å¡å¯†è¾“å…¥æ¡†
    self.cardInput = Instance.new("TextBox")
    self.cardInput.Size = UDim2.new(1, -20, 0, 40)
    self.cardInput.Position = UDim2.new(0, 10, 0, 100)
    self.cardInput.PlaceholderText = "è¾“å…¥å¡å¯†..."
    self.cardInput.Text = ""
    self.cardInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    self.cardInput.BackgroundColor3 = Color3.fromRGB(40, 45, 65)
    self.cardInput.TextSize = 14
    self.cardInput.Font = Enum.Font.Gotham
    self.cardInput.Parent = self.mainFrame
    
    local inputCorner = Instance.new("UICorner")
    inputCorner.CornerRadius = UDim.new(0, 6)
    inputCorner.Parent = self.cardInput
    
    -- éªŒè¯æŒ‰é’®
    self.verifyButton = Instance.new("TextButton")
    self.verifyButton.Size = UDim2.new(1, -20, 0, 35)
    self.verifyButton.Position = UDim2.new(0, 10, 0, 150)
    self.verifyButton.Text = "âœ… éªŒè¯å¡å¯†"
    self.verifyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    self.verifyButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    self.verifyButton.TextSize = 14
    self.verifyButton.Font = Enum.Font.GothamBold
    self.verifyButton.Parent = self.mainFrame
    
    local verifyCorner = Instance.new("UICorner")
    verifyCorner.CornerRadius = UDim.new(0, 6)
    verifyCorner.Parent = self.verifyButton
    
    -- è‡ªåŠ¨å‘è¨€æŒ‰é’®
    self.autoChatButton = Instance.new("TextButton")
    self.autoChatButton.Size = UDim2.new(0, 150, 0, 30)
    self.autoChatButton.Position = UDim2.new(0, 10, 0, 195)
    self.autoChatButton.Text = "è·³è½¬æµè§ˆå™¨"
    self.autoChatButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    self.autoChatButton.BackgroundColor3 = Color3.fromRGB(120, 80, 160)
    self.autoChatButton.TextSize = 12
    self.autoChatButton.Font = Enum.Font.GothamBold
    self.autoChatButton.Parent = self.mainFrame
    
    local autoChatCorner = Instance.new("UICorner")
    autoChatCorner.CornerRadius = UDim.new(0, 6)
    autoChatCorner.Parent = self.autoChatButton
    
    -- å¤åˆ¶é“¾æ¥æŒ‰é’®
    self.copyLinkButton = Instance.new("TextButton")
    self.copyLinkButton.Size = UDim2.new(0, 150, 0, 30)
    self.copyLinkButton.Position = UDim2.new(1, -160, 0, 195)
    self.copyLinkButton.Text = "ğŸ“ å¤åˆ¶é“¾æ¥"
    self.copyLinkButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    self.copyLinkButton.BackgroundColor3 = Color3.fromRGB(45, 80, 120)
    self.copyLinkButton.TextSize = 12
    self.copyLinkButton.Font = Enum.Font.GothamBold
    self.copyLinkButton.Parent = self.mainFrame
    
    local copyLinkCorner = Instance.new("UICorner")
    copyLinkCorner.CornerRadius = UDim.new(0, 6)
    copyLinkCorner.Parent = self.copyLinkButton
    
    -- çŠ¶æ€æ˜¾ç¤º
    self.statusLabel = Instance.new("TextLabel")
    self.statusLabel.Size = UDim2.new(1, -20, 0, 50)
    self.statusLabel.Position = UDim2.new(0, 10, 0, 235)
    self.statusLabel.BackgroundColor3 = Color3.fromRGB(35, 40, 55)
    self.statusLabel.Text = "ç­‰å¾…éªŒè¯..."
    self.statusLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
    self.statusLabel.TextSize = 12
    self.statusLabel.TextWrapped = true
    self.statusLabel.Font = Enum.Font.Gotham
    self.statusLabel.Parent = self.mainFrame
    
    local statusCorner = Instance.new("UICorner")
    statusCorner.CornerRadius = UDim.new(0, 6)
    statusCorner.Parent = self.statusLabel
    
    -- ç»‘å®šäº‹ä»¶
    self:setupEvents()
end

-- è®¾ç½®äº‹ä»¶å¤„ç†
function CardAuthSystem:setupEvents()
    -- éªŒè¯æŒ‰é’®ç‚¹å‡»
    self.verifyButton.MouseButton1Click:Connect(function()
        self:verifyCard()
    end)
    
    -- è‡ªåŠ¨å‘è¨€æŒ‰é’®ç‚¹å‡»
    self.autoChatButton.MouseButton1Click:Connect(function()
        self:autoChatInGame()
    end)
    
    -- å¤åˆ¶é“¾æ¥æŒ‰é’®ç‚¹å‡»
    self.copyLinkButton.MouseButton1Click:Connect(function()
        self:copyOfficialLink()
    end)
    
    -- å›è½¦é”®éªŒè¯
    self.cardInput.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            self:verifyCard()
        end
    end)
end

-- éªŒè¯å¡å¯†
function CardAuthSystem:verifyCard()
    local cardKey = self.cardInput.Text:gsub("^%s*(.-)%s*$", "%1")
    
    if cardKey == "" then
        self:updateStatus("è¯·è¾“å…¥å¡å¯†å·ç ", Color3.fromRGB(255, 100, 100))
        return
    end
    
    -- æ£€æŸ¥ç³»ç»Ÿé”å®š
    if self.lockTime > os.time() then
        local remaining = self.lockTime - os.time()
        self:updateStatus("ç³»ç»Ÿé”å®šä¸­ï¼Œ" .. remaining .. "ç§’åé‡è¯•", Color3.fromRGB(255, 100, 100))
        return
    end
    
    -- éªŒè¯å¡å¯†
    local card = self.cardDatabase[cardKey]
    
    if card then
        if card.used then
            self:updateStatus("å¡å¯†å·²è¢«ä½¿ç”¨", Color3.fromRGB(255, 100, 100))
            self.attempts = self.attempts + 1
        else
            -- éªŒè¯æˆåŠŸ
            card.used = true
            self.isVerified = true
            self:updateStatus("âœ… éªŒè¯æˆåŠŸï¼\nç±»å‹: " .. card.type .. "\næ—¶é•¿: " .. card.days .. "å¤©", Color3.fromRGB(100, 255, 100))
            
            -- ç¦ç”¨è¾“å…¥
            self.cardInput.Text = "å·²éªŒè¯æˆåŠŸ"
            self.cardInput.TextColor3 = Color3.fromRGB(100, 255, 100)
            self.verifyButton.Text = "âœ… å·²éªŒè¯"
            self.verifyButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
            self.verifyButton.Active = false
            
            -- 2ç§’åæ‰§è¡Œä¸»è„šæœ¬
            wait(2)
            self:executeMainScript()
        end
    else
        self.attempts = self.attempts + 1
        local remainingAttempts = self.maxAttempts - self.attempts
        
        if remainingAttempts > 0 then
            self:updateStatus("å¡å¯†æ— æ•ˆï¼å‰©ä½™æ¬¡æ•°: " .. remainingAttempts, Color3.fromRGB(255, 100, 100))
        else
            self.lockTime = os.time() + 300
            self:updateStatus("é”™è¯¯æ¬¡æ•°è¿‡å¤šï¼é”å®š5åˆ†é’Ÿ", Color3.fromRGB(255, 100, 100))
        end
    end
end

-- è‡ªåŠ¨åœ¨æ¸¸æˆä¸­å‘è¨€
function CardAuthSystem:autoChatInGame()
    self:updateStatus("æ­£åœ¨å‘é€æ¶ˆæ¯...", Color3.fromRGB(255, 200, 100))
    self.autoChatButton.Text = "è·³è½¬ä¸­..."
    
    -- éšæœºé€‰æ‹©ä¸€æ¡æ¶ˆæ¯
    local randomIndex = math.random(1, #self.autoMessages)
    local message = self.autoMessages[randomIndex]
    
    -- å°è¯•å‘é€æ¶ˆæ¯
    local success = self:sendChatMessage(message)
    
    if success then
        self:updateStatus("âœ… è·³è½¬æˆåŠŸæˆåŠŸï¼\n" .. message, Color3.fromRGB(100, 255, 100))
        
        -- æ˜¾ç¤ºé€šçŸ¥
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "è·³è½¬æµè§ˆå™¨",
            Text = "è·³è½¬ä¸­",
            Duration = 3
        })
    else
        self:updateStatus("âŒ è·³è½¬å¤±è´¥\nè¯·æ£€æŸ¥èŠå¤©æƒé™", Color3.fromRGB(255, 100, 100))
    end
    
    wait(1.5)
    self.autoChatButton.Text = "è·³è½¬æµè§ˆå™¨"
end

-- å‘é€èŠå¤©æ¶ˆæ¯
function CardAuthSystem:sendChatMessage(message)
    local success = false
    
    -- æ–¹æ³•1: ä½¿ç”¨TextChatService (æ–°ç‰ˆ)
    local textChatSuccess, textChatResult = pcall(function()
        local TextChatService = game:GetService("TextChatService")
        if TextChatService and TextChatService.TextChannels then
            local generalChannel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
            if generalChannel then
                generalChannel:SendAsync(message)
                success = true
            end
        end
    end)
    
    -- æ–¹æ³•2: ä½¿ç”¨é»˜è®¤èŠå¤©ç³»ç»Ÿ
    if not success then
        local defaultChatSuccess, defaultChatResult = pcall(function()
            game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(message, "All")
            success = true
        end)
    end
    
    -- æ–¹æ³•3: ä½¿ç”¨èŠå¤©æœåŠ¡
    if not success then
        local chatServiceSuccess, chatServiceResult = pcall(function()
            local Players = game:GetService("Players")
            local localPlayer = Players.LocalPlayer
            if localPlayer and localPlayer.Character then
                local head = localPlayer.Character:FindFirstChild("Head")
                if head then
                    local ChatService = game:GetService("Chat")
                    ChatService:Chat(head, message)
                    success = true
                end
            end
        end)
    end
    
    return success
end

-- å¤åˆ¶å®˜æ–¹é“¾æ¥åˆ°å‰ªåˆ‡æ¿
function CardAuthSystem:copyOfficialLink()
    self:updateStatus("æ­£åœ¨å¤åˆ¶é“¾æ¥...", Color3.fromRGB(255, 200, 100))
    self.copyLinkButton.Text = "ğŸ“‹ å¤åˆ¶ä¸­..."
    
    -- å°è¯•å¤åˆ¶åˆ°å‰ªåˆ‡æ¿
    local success = pcall(function()
        if setclipboard then
            setclipboard(self.officialLink)
            self:updateStatus("âœ… é“¾æ¥å·²å¤åˆ¶ï¼\n" .. self.officialLink, Color3.fromRGB(100, 255, 100))
        else
            self.cardInput.Text = self.officialLink
            self:updateStatus("ğŸ”— é“¾æ¥å·²å¡«å…¥è¾“å…¥æ¡†\nè¯·æ‰‹åŠ¨å¤åˆ¶", Color3.fromRGB(255, 200, 100))
        end
    end)
    
    if not success then
        self.cardInput.Text = self.officialLink
        self:updateStatus("ğŸ”— é“¾æ¥å·²å¡«å…¥è¾“å…¥æ¡†\nè¯·æ‰‹åŠ¨å¤åˆ¶", Color3.fromRGB(255, 200, 100))
    end
    
    wait(1.5)
    self.copyLinkButton.Text = "ğŸ“ å¤åˆ¶é“¾æ¥"
end

-- æ›´æ–°çŠ¶æ€æ˜¾ç¤º
function CardAuthSystem:updateStatus(message, color)
    self.statusLabel.Text = message
    self.statusLabel.TextColor3 = color
end

-- æ‰§è¡Œä¸»è„šæœ¬
function CardAuthSystem:executeMainScript()
    -- éšè—éªŒè¯ç•Œé¢
    self.screenGui:Destroy()
    
    -- æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "ğŸ‰ éªŒè¯æˆåŠŸ",
        Text = "æ­£åœ¨åŠ è½½è„šæœ¬...",
        Duration = 3
    })
    
    -- æ‰§è¡Œæ‚¨çš„ä¸»è„šæœ¬
    self:runMainScript()
end

-- ä¸»è„šæœ¬æ‰§è¡Œå‡½æ•°
function CardAuthSystem:runMainScript()
    print("ğŸ¯ å¡å¯†éªŒè¯é€šè¿‡ï¼")
    print("ğŸš€ æ­£åœ¨åŠ è½½ä¸»è„šæœ¬...")
    
    -- æ‰§è¡Œæ‚¨çš„ä¸»è„šæœ¬
    loadstring(game:HttpGet("https://raw.githubusercontent.com/liuliuqiang404-code/-/refs/heads/main/%E5%85%AC%E5%91%8A"))()
    
    print("âœ… ä¸»è„šæœ¬åŠ è½½å®Œæˆï¼")
end

-- å¯åŠ¨ç³»ç»Ÿ
function CardAuthSystem:start()
    self:createCompactUI()
    
    -- æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "åˆ˜æŸæˆæƒéªŒè¯",
        Text = "è¯·è¾“å…¥å¡å¯†æ¿€æ´»è„šæœ¬",
        Duration = 3
    })
end

-- =============================================
-- ç³»ç»Ÿå¯åŠ¨
-- =============================================

-- åˆ›å»ºå¹¶å¯åŠ¨ç³»ç»Ÿ
local authSystem = CardAuthSystem:new()
authSystem:start()

-- é˜²æ­¢é‡å¤æ‰§è¡Œ
if _G.CARD_AUTH_LOADED then
    return
end
_G.CARD_AUTH_LOADED = true

return CardAuthSystem