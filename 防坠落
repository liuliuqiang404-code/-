local AntiFallUI = {}
AntiFallUI.__index = AntiFallUI

function AntiFallUI:new()
    local system = setmetatable({}, AntiFallUI)
    system:initialize()
    return system
end

function AntiFallUI:initialize()
    self.enabled = true
    self.isMinimized = false
    self.damageReduction = 1.0  -- 100%å‡ä¼¤
    
    self:setupProtection()
    self:createUI()
end

-- è®¾ç½®ä¿æŠ¤ç³»ç»Ÿ
function AntiFallUI:setupProtection()
    local Players = game:GetService("Players")
    local localPlayer = Players.LocalPlayer
    
    local function setupCharacter(character)
        local humanoid = character:WaitForChild("Humanoid")
        
        -- 100%å…ç–«æ‰€æœ‰ä¼¤å®³
        humanoid.HealthChanged:Connect(function()
            if self.enabled and humanoid.Health < humanoid.MaxHealth then
                humanoid.Health = humanoid.MaxHealth
            end
        end)
        
        -- å…ç–«å è½çŠ¶æ€
        if self.enabled then
            humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
            humanoid:SetStateEnabled(Enum.HumanoidStateType.Freefall, false)
        end
    end
    
    localPlayer.CharacterAdded:Connect(setupCharacter)
    if localPlayer.Character then
        setupCharacter(localPlayer.Character)
    end
end

-- åˆ›å»ºUIç•Œé¢
function AntiFallUI:createUI()
    -- ä¸»GUI
    self.screenGui = Instance.new("ScreenGui")
    self.screenGui.Name = "AntiFallUI"
    self.screenGui.Parent = game:GetService("CoreGui")
    
    -- æœ€å°åŒ–æŒ‰é’®ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰
    self.minimizeBtn = Instance.new("TextButton")
    self.minimizeBtn.Size = UDim2.new(0, 100, 0, 30)
    self.minimizeBtn.Position = UDim2.new(0, 10, 0, 10)
    self.minimizeBtn.Text = "é˜²å è½"
    self.minimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    self.minimizeBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
    self.minimizeBtn.TextSize = 14
    self.minimizeBtn.Font = Enum.Font.GothamBold
    self.minimizeBtn.Parent = self.screenGui
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = self.minimizeBtn
    
    -- ä¸»æ§åˆ¶é¢æ¿ï¼ˆé»˜è®¤éšè—ï¼‰
    self.mainFrame = Instance.new("Frame")
    self.mainFrame.Size = UDim2.new(0, 200, 0, 160)
    self.mainFrame.Position = UDim2.new(0, 10, 0, 50)
    self.mainFrame.BackgroundColor3 = Color3.fromRGB(30, 35, 50)
    self.mainFrame.BorderSizePixel = 0
    self.mainFrame.Visible = false
    self.mainFrame.Parent = self.screenGui
    
    local frameCorner = Instance.new("UICorner")
    frameCorner.CornerRadius = UDim.new(0, 8)
    frameCorner.Parent = self.mainFrame
    
    local frameStroke = Instance.new("UIStroke")
    frameStroke.Color = Color3.fromRGB(0, 150, 255)
    frameStroke.Thickness = 2
    frameStroke.Parent = self.mainFrame
    
    -- æ ‡é¢˜æ 
    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1, 0, 0, 30)
    titleBar.BackgroundColor3 = Color3.fromRGB(40, 45, 65)
    titleBar.BorderSizePixel = 0
    titleBar.Parent = self.mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 8)
    titleCorner.Parent = titleBar
    
    -- æ ‡é¢˜æ–‡å­—
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, -60, 1, 0)
    titleLabel.Position = UDim2.new(0, 10, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "é˜²å è½ç³»ç»Ÿ"
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextSize = 14
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = titleBar
    
    -- æœ€å°åŒ–æŒ‰é’®ï¼ˆåœ¨é¢æ¿å†…ï¼‰
    self.minimizeToggleBtn = Instance.new("TextButton")
    self.minimizeToggleBtn.Size = UDim2.new(0, 25, 0, 25)
    self.minimizeToggleBtn.Position = UDim2.new(1, -30, 0, 2)
    self.minimizeToggleBtn.Text = "âˆ’"
    self.minimizeToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    self.minimizeToggleBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 100)
    self.minimizeToggleBtn.TextSize = 16
    self.minimizeToggleBtn.Font = Enum.Font.GothamBold
    self.minimizeToggleBtn.Parent = titleBar
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(1, 0)
    toggleCorner.Parent = self.minimizeToggleBtn
    
    -- å¼€å…³æŒ‰é’®
    self.toggleBtn = Instance.new("TextButton")
    self.toggleBtn.Size = UDim2.new(1, -20, 0, 35)
    self.toggleBtn.Position = UDim2.new(0, 10, 0, 40)
    self.toggleBtn.Text = "å·²å¯ç”¨ (100%)"
    self.toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    self.toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
    self.toggleBtn.TextSize = 14
    self.toggleBtn.Font = Enum.Font.GothamBold
    self.toggleBtn.Parent = self.mainFrame
    
    local toggleBtnCorner = Instance.new("UICorner")
    toggleBtnCorner.CornerRadius = UDim.new(0, 6)
    toggleBtnCorner.Parent = self.toggleBtn
    
    -- çŠ¶æ€æ˜¾ç¤º
    self.statusLabel = Instance.new("TextLabel")
    self.statusLabel.Size = UDim2.new(1, -20, 0, 40)
    self.statusLabel.Position = UDim2.new(0, 10, 0, 85)
    self.statusLabel.BackgroundTransparency = 1
    self.statusLabel.Text = "çŠ¶æ€: 100%ä¼¤å®³å…ç–«\nå è½ä¼¤å®³å®Œå…¨æ— æ•ˆ"
    self.statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    self.statusLabel.TextSize = 12
    self.statusLabel.TextWrapped = true
    self.statusLabel.Font = Enum.Font.Gotham
    self.statusLabel.Parent = self.mainFrame
    
    -- æç¤ºæ–‡å­—
    local hintLabel = Instance.new("TextLabel")
    hintLabel.Size = UDim2.new(1, -20, 0, 30)
    hintLabel.Position = UDim2.new(0, 10, 1, -35)
    hintLabel.BackgroundTransparency = 1
    hintLabel.Text = "ç‚¹å‡»æ ‡é¢˜æ æŒ‰é’®æœ€å°åŒ–"
    hintLabel.TextColor3 = Color3.fromRGB(150, 150, 200)
    hintLabel.TextSize = 10
    hintLabel.Font = Enum.Font.Gotham
    hintLabel.Parent = self.mainFrame
    
    -- ç»‘å®šäº‹ä»¶
    self:setupEvents()
end

-- è®¾ç½®äº‹ä»¶
function AntiFallUI:setupEvents()
    -- æœ€å°åŒ–æŒ‰é’®ç‚¹å‡»ï¼ˆæ˜¾ç¤º/éšè—ä¸»é¢æ¿ï¼‰
    self.minimizeBtn.MouseButton1Click:Connect(function()
        self:toggleMainPanel()
    end)
    
    -- é¢æ¿å†…æœ€å°åŒ–æŒ‰é’®
    self.minimizeToggleBtn.MouseButton1Click:Connect(function()
        self:minimizePanel()
    end)
    
    -- å¼€å…³æŒ‰é’®
    self.toggleBtn.MouseButton1Click:Connect(function()
        self:toggleProtection()
    end)
end

-- åˆ‡æ¢ä¸»é¢æ¿æ˜¾ç¤º/éšè—
function AntiFallUI:toggleMainPanel()
    self.mainFrame.Visible = not self.mainFrame.Visible
    self.isMinimized = not self.mainFrame.Visible
    
    if self.mainFrame.Visible then
        self.minimizeBtn.Text = "æ‰“å¼€ä¸­..."
        wait(0.1)
        self.minimizeBtn.Text = "é˜²å è½"
    else
        self.minimizeBtn.Text = "é˜²å è½"
    end
end

-- æœ€å°åŒ–é¢æ¿
function AntiFallUI:minimizePanel()
    self.mainFrame.Visible = false
    self.isMinimized = true
    self.minimizeBtn.Text = "é˜²å è½"
end

-- åˆ‡æ¢ä¿æŠ¤å¼€å…³
function AntiFallUI:toggleProtection()
    self.enabled = not self.enabled
    
    if self.enabled then
        self.toggleBtn.Text = "å·²å¯ç”¨ (100%)"
        self.toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
        self.statusLabel.Text = "çŠ¶æ€: 100%ä¼¤å®³å…ç–«\nå è½ä¼¤å®³å®Œå…¨æ— æ•ˆ"
        self.statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        self.minimizeBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
        print("100%é˜²å è½å·²å¯ç”¨")
    else
        self.toggleBtn.Text = "å·²ç¦ç”¨"
        self.toggleBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
        self.statusLabel.Text = "çŠ¶æ€: å·²ç¦ç”¨\nå è½ä¼¤å®³æ­£å¸¸"
        self.statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        self.minimizeBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
        print("100%é˜²å è½å·²ç¦ç”¨")
    end
    
    -- é‡æ–°è®¾ç½®è§’è‰²ä¿æŠ¤
    self:setupProtection()
end

-- å¯åŠ¨ç³»ç»Ÿ
function AntiFallUI:start()
    print("100%é˜²å è½ç³»ç»Ÿå¯åŠ¨")
    print("ä¼¤å®³å…ç–«: 100%")
    print("UI: å¯æœ€å°åŒ–/æœ€å¤§åŒ–")
    
    -- æ˜¾ç¤ºå¯åŠ¨é€šçŸ¥
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "æŒ¨æ‰“è¦ç«‹æ­£ğŸ˜¡ğŸ˜¡ğŸ˜¡",
        Text = "100%ä¼¤å®³å…ç–«å·²å¯ç”¨\nç‚¹å‡»æŒ‰é’®æ§åˆ¶UI",
        Duration = 5
    })
end

-- =============================================
-- ç³»ç»Ÿå¯åŠ¨
-- =============================================

-- åˆ›å»ºå¹¶å¯åŠ¨ç³»ç»Ÿ
local antiFall = AntiFallUI:new()
antiFall:start()

-- é˜²æ­¢é‡å¤æ‰§è¡Œ
if _G.ANTI_FALL_UI then return end
_G.ANTI_FALL_UI = true

return AntiFallUI
