-- =============================================
-- ç½—å¸ƒä¹æ€å¿è€…æ³¨å…¥å™¨ - çº¯å‡€å¡å¯†éªŒè¯ç³»ç»Ÿ
-- ä½œè€…: AIåŠ©æ‰‹
-- ç‰ˆæœ¬: v1.0
-- =============================================

local CardSystem = {}
CardSystem.__index = CardSystem

-- å¡å¯†æ•°æ®
local cardData = {
    cards = {
        -- ä¸€æ¬¡æ€§å¡å¯†ç¤ºä¾‹ (ä½¿ç”¨åç«‹å³å¤±æ•ˆ)
        ["NINJA-2024-VIP1"] = {type = "single", value = "vip", used = false},
        ["ROBLOX-NINJA-PRO"] = {type = "single", value = "pro", used = false},
        ["å¿è€…-æ³¨å…¥-ç‰¹æƒ"] = {type = "single", value = "vip", used = false},
        
        -- æ°¸ä¹…å¡å¯†ç¤ºä¾‹ (æ°¸ä¹…æœ‰æ•ˆ)
        ["LM_NBYJKMWAK"] = {type = "permanent", value = "èšæ²¹ğŸ¤“"},
        ["LM"] = {type = "permanent", value = "ä¸»æ’­"},
        ["LM_NBYJKMHEO"] = {type = "permanent", value = "supreme"},
    },
    settings = {
        maxAttempts = 3,
        lockTime = 300
    },
    usedCards = {}
}

-- åˆå§‹åŒ–ç³»ç»Ÿ
function CardSystem:init()
    self.attempts = 0
    self.isLocked = false
    self.lockTime = 0
    self.isVerified = false
    self.currentCard = nil
    self:loadData()
end

-- éªŒè¯å¡å¯†
function CardSystem:verifyCard(cardKey)
    -- æ£€æŸ¥ç³»ç»Ÿé”å®š
    if self.isLocked then
        local remaining = self.lockTime - os.time()
        if remaining > 0 then
            return false, string.format("ç³»ç»Ÿå·²é”å®šï¼Œè¯·ç­‰å¾… %d ç§’", remaining)
        else
            self.isLocked = false
            self.attempts = 0
        end
    end
    
    -- æ£€æŸ¥å¡å¯†æ˜¯å¦å­˜åœ¨
    local card = cardData.cards[cardKey]
    if not card then
        self.attempts = self.attempts + 1
        if self.attempts >= cardData.settings.maxAttempts then
            self:lockSystem()
            return false, "é”™è¯¯æ¬¡æ•°è¿‡å¤šï¼ç³»ç»Ÿé”å®š5åˆ†é’Ÿ"
        end
        return false, string.format("å¡å¯†æ— æ•ˆï¼å‰©ä½™å°è¯•æ¬¡æ•°: %d", cardData.settings.maxAttempts - self.attempts)
    end
    
    -- æ£€æŸ¥ä¸€æ¬¡æ€§å¡å¯†æ˜¯å¦å·²ä½¿ç”¨
    if card.type == "single" and card.used then
        return false, "è¯¥å¡å¯†å·²è¢«ä½¿ç”¨"
    end
    
    -- æ ‡è®°ä¸€æ¬¡æ€§å¡å¯†ä¸ºå·²ä½¿ç”¨
    if card.type == "single" then
        card.used = true
        cardData.usedCards[cardKey] = card
    end
    
    self.currentCard = card
    self.isVerified = true
    self.attempts = 0
    
    self:saveData()
    return true, card
end

-- é”å®šç³»ç»Ÿ
function CardSystem:lockSystem()
    self.isLocked = true
    self.lockTime = os.time() + cardData.settings.lockTime
end

-- ä¿å­˜æ•°æ®
function CardSystem:saveData()
    local success, result = pcall(function()
        local data = {
            usedCards = cardData.usedCards,
            attempts = self.attempts,
            isLocked = self.isLocked,
            lockTime = self.lockTime
        }
        if game:GetService("DataStoreService"):GetDataStore("NinjaCardSystem") then
            game:GetService("DataStoreService"):GetDataStore("NinjaCardSystem"):SetAsync("card_data", data)
        end
    end)
end

-- åŠ è½½æ•°æ®
function CardSystem:loadData()
    local success, result = pcall(function()
        if game:GetService("DataStoreService"):GetDataStore("NinjaCardSystem") then
            local data = game:GetService("DataStoreService"):GetDataStore("NinjaCardSystem"):GetAsync("card_data")
            if data then
                cardData.usedCards = data.usedCards or {}
                self.attempts = data.attempts or 0
                self.isLocked = data.isLocked or false
                self.lockTime = data.lockTime or 0
                
                -- æ›´æ–°å¡å¯†ä½¿ç”¨çŠ¶æ€
                for cardKey, card in pairs(cardData.cards) do
                    if cardData.usedCards[cardKey] then
                        card.used = true
                    end
                end
            end
        end
    end)
end

-- åˆ›å»ºUIç•Œé¢
function CardSystem:createUI()
    -- ä¸»çª—å£
    self.mainWindow = Instance.new("ScreenGui")
    self.mainWindow.Name = "NinjaCardSystem"
    self.mainWindow.Parent = game:GetService("CoreGui")
    
    -- ä¸»æ¡†æ¶
    self.mainFrame = Instance.new("Frame")
    self.mainFrame.Size = UDim2.new(0, 400, 0, 350)
    self.mainFrame.Position = UDim2.new(0.5, -200, 0.5, -175)
    self.mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    self.mainFrame.BorderSizePixel = 0
    self.mainFrame.Parent = self.mainWindow
    
    -- åœ†è§’æ•ˆæœ
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = self.mainFrame
    
    -- æ ‡é¢˜
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 60)
    title.Position = UDim2.new(0, 0, 0, 0)
    title.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    title.Text = "ğŸ” åˆ˜æŸè„šæœ¬éªŒè¯ç¨‹åº"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 24
    title.Font = Enum.Font.GothamBold
    title.Parent = self.mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 12)
    titleCorner.Parent = title
    
    -- å‰¯æ ‡é¢˜
    local subtitle = Instance.new("TextLabel")
    subtitle.Size = UDim2.new(1, 0, 0, 40)
    subtitle.Position = UDim2.new(0, 0, 0, 60)
    subtitle.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    subtitle.Text = "è¯·è¾“å…¥æ‚¨çš„å¡å¯†è¿›è¡ŒéªŒè¯"
    subtitle.TextColor3 = Color3.fromRGB(200, 200, 200)
    subtitle.TextSize = 16
    subtitle.Font = Enum.Font.Gotham
    subtitle.Parent = self.mainFrame
    
    -- å¡å¯†è¾“å…¥æ¡†
    self.cardInput = Instance.new("TextBox")
    self.cardInput.Size = UDim2.new(0, 360, 0, 50)
    self.cardInput.Position = UDim2.new(0.5, -180, 0.3, 0)
    self.cardInput.PlaceholderText = "è¯·è¾“å…¥å¡å¯†..."
    self.cardInput.Text = ""
    self.cardInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    self.cardInput.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    self.cardInput.TextSize = 18
    self.cardInput.Font = Enum.Font.Gotham
    self.cardInput.Parent = self.mainFrame
    
    local inputCorner = Instance.new("UICorner")
    inputCorner.CornerRadius = UDim.new(0, 8)
    inputCorner.Parent = self.cardInput
    
    -- éªŒè¯æŒ‰é’®
    self.verifyButton = Instance.new("TextButton")
    self.verifyButton.Size = UDim2.new(0, 200, 0, 50)
    self.verifyButton.Position = UDim2.new(0.5, -100, 0.5, 0)
    self.verifyButton.Text = "ğŸ”“ éªŒè¯å¡å¯†"
    self.verifyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    self.verifyButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    self.verifyButton.TextSize = 20
    self.verifyButton.Font = Enum.Font.GothamBold
    self.verifyButton.Parent = self.mainFrame
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 8)
    buttonCorner.Parent = self.verifyButton
    
    -- ç»“æœæ˜¾ç¤º
    self.resultLabel = Instance.new("TextLabel")
    self.resultLabel.Size = UDim2.new(0, 360, 0, 80)
    self.resultLabel.Position = UDim2.new(0.5, -180, 0.7, 0)
    self.resultLabel.Text = "ç­‰å¾…éªŒè¯..."
    self.resultLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    self.resultLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    self.resultLabel.TextSize = 16
    self.resultLabel.TextWrapped = true
    self.resultLabel.Font = Enum.Font.Gotham
    self.resultLabel.Parent = self.mainFrame
    
    local resultCorner = Instance.new("UICorner")
    resultCorner.CornerRadius = UDim.new(0, 8)
    resultCorner.Parent = self.resultLabel
    
    -- çŠ¶æ€ä¿¡æ¯
    self.statusLabel = Instance.new("TextLabel")
    self.statusLabel.Size = UDim2.new(1, 0, 0, 30)
    self.statusLabel.Position = UDim2.new(0, 0, 1, -30)
    self.statusLabel.Text = "çŠ¶æ€: æœªéªŒè¯"
    self.statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
    self.statusLabel.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    self.statusLabel.TextSize = 14
    self.statusLabel.Font = Enum.Font.Gotham
    self.statusLabel.Parent = self.mainFrame
    
    -- æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    self.verifyButton.MouseButton1Click:Connect(function()
        self:onVerifyButtonClick()
    end)
    
    -- å›è½¦é”®éªŒè¯
    self.cardInput.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            self:onVerifyButtonClick()
        end
    end)
end

-- éªŒè¯æŒ‰é’®ç‚¹å‡»äº‹ä»¶
function CardSystem:onVerifyButtonClick()
    local cardKey = self.cardInput.Text:gsub("^%s*(.-)%s*$", "%1") -- å»é™¤å‰åç©ºæ ¼
    
    if cardKey == "" then
        self:showResult("è¯·è¾“å…¥å¡å¯†", Color3.fromRGB(255, 100, 100))
        return
    end
    
    local success, result = self:verifyCard(cardKey)
    
    if success then
        local card = result
        local cardType = card.type == "single" and "ä¸€æ¬¡æ€§å¡å¯†" or "æ°¸ä¹…å¡å¯†"
        local message = string.format("âœ… éªŒè¯æˆåŠŸï¼\nå¡å¯†ç±»å‹: %s\næƒé™ç­‰çº§: %s\næ­£åœ¨å¯åŠ¨ä¸»ç¨‹åº...", cardType, card.value)
        
        self:showResult(message, Color3.fromRGB(100, 255, 100))
        self.statusLabel.Text = "çŠ¶æ€: å·²éªŒè¯ âœ…"
        self.statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        -- ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
        self.verifyButton.Text = "âœ… éªŒè¯æˆåŠŸ"
        self.verifyButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
        self.verifyButton.Active = false
        
        -- 2ç§’åæ‰§è¡Œä¸»è„šæœ¬
        wait(2)
        self:executeMainScript()
    else
        self:showResult("âŒ " .. result, Color3.fromRGB(255, 100, 100))
    end
end

-- æ˜¾ç¤ºç»“æœ
function CardSystem:showResult(message, color)
    self.resultLabel.Text = message
    self.resultLabel.TextColor3 = color
end

-- æ‰§è¡Œä¸»è„šæœ¬
function CardSystem:executeMainScript()
    -- éšè—éªŒè¯ç•Œé¢
    self.mainWindow:Destroy()
    
    -- æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "ğŸ¯ éªŒè¯æˆåŠŸ",
        Text = "å¡å¯†éªŒè¯é€šè¿‡ï¼Œæ­£åœ¨åŠ è½½ä¸»è„šæœ¬...",
        Duration = 3,
        Icon = "rbxassetid://0"
    })
    
    -- åœ¨è¿™é‡Œæ‰§è¡Œæ‚¨çš„ä¸»è„šæœ¬
    -- è¯·å°†æ‚¨çš„åŸæœ‰ä¸»è„šæœ¬ä»£ç æ”¾åœ¨è¿™é‡Œ
    self:runUserMainScript()
end

-- ç”¨æˆ·ä¸»è„šæœ¬æ‰§è¡Œå‡½æ•°
function CardSystem:runUserMainScript()
    -- =============================================
    -- è¿™é‡Œæ‰§è¡Œæ‚¨çš„ä¸»è„šæœ¬å†…å®¹
    -- åªæœ‰å¡å¯†éªŒè¯æˆåŠŸåæ‰ä¼šæ‰§è¡Œä¸‹é¢çš„ä»£ç 
    -- =============================================
    
    print("è„šæœ¬å·²æ¿€æ´»ï¼")
    print("å¡å¯†éªŒè¯æˆåŠŸï¼Œæ­£åœ¨æ‰§è¡Œä¸»ç¨‹åº...")
    
    -- æ‚¨çš„åŸæœ‰ä¸»è„šæœ¬ä»£ç æ”¾åœ¨è¿™é‡Œ
    -- ä¾‹å¦‚ï¼š
    -- loadstring(game:HttpGet("æ‚¨çš„è„šæœ¬URL"))()
    -- æˆ–è€…ç›´æ¥å†™å…¥æ‚¨çš„åŠŸèƒ½ä»£ç 
    
    -- ç¤ºä¾‹ï¼šæ˜¾ç¤ºä¸»ç¨‹åºå·²å¯åŠ¨
    loadstring(game:HttpGet("https://raw.githubusercontent.com/liuliuqiang404-code/-/refs/heads/main/åˆ˜æŸè„šæœ¬åŠ è½½å™¨"))()game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "ä¸»ç¨‹åºå·²å¯åŠ¨",
        Text = "åˆ˜æŸè„šæœ¬è¿è¡Œä¸­ï¼",
        Duration = 5
    })
end

-- å¯åŠ¨ç³»ç»Ÿ
function CardSystem:start()
    self:init()
    self:createUI()
    
    -- æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "ğŸ” å¡å¯†éªŒè¯",
        Text = "è¯·è¾“å…¥å¡å¯†æ¿€æ´»ç³»ç»Ÿ",
        Duration = 5
    })
end

-- =============================================
-- ç³»ç»Ÿå¯åŠ¨
-- =============================================

-- åˆ›å»ºå…¨å±€å®ä¾‹
getgenv().NinjaCardSystem = CardSystem

-- å¯åŠ¨å¡å¯†ç³»ç»Ÿ
local system = setmetatable({}, CardSystem)
system:start()

-- é˜²æ­¢é‡å¤æ‰§è¡Œ
if _G.NINJA_SYSTEM_LOADED then
    return
end
_G.NINJA_SYSTEM_LOADED = true

-- =============================================
-- æ³¨æ„ï¼šæ‚¨çš„ä¸»è„šæœ¬åº”è¯¥æ”¾åœ¨ runUserMainScript() å‡½æ•°ä¸­
-- =============================================
